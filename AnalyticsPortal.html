<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Analytics Portal</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6f8;
  margin: 0;
}
.container {
  max-width: 1200px;
  margin: auto;
  padding: 20px;
}
.tabs {
  display: flex;
  border-bottom: 2px solid #ddd;
  margin-bottom: 20px;
}
.tab {
  padding: 12px 20px;
  cursor: pointer;
  font-weight: bold;
  border-bottom: 4px solid transparent;
}
.tab.active {
  border-bottom-color: #0f62fe;
  color: #0f62fe;
}
.tab-content {
  display: none;
}
.tab-content.active {
  display: block;
}
.card {
  background: #fff;
  padding: 20px;
  margin-bottom: 20px;
  border-radius: 8px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}
h1, h2 {
  margin-top: 0;
}
h2.engineer { color: #0f62fe; }
h2.user { color: #198038; }
label {
  display: block;
  font-weight: bold;
  margin-top: 10px;
}
select, input {
  width: 100%;
  padding: 8px;
  margin-top: 6px;
}
button {
  margin-top: 15px;
  padding: 10px 14px;
  border: none;
  cursor: pointer;
  border-radius: 4px;
}
button.primary {
  background: #0f62fe;
  color: #fff;
}
button.success {
  background: #198038;
  color: #fff;
}
pre {
  background: #0d1117;
  color: #c9d1d9;
  padding: 15px;
  border-radius: 6px;
}
.row {
  display: flex;
  gap: 20px;
}
.col {
  flex: 1;
}
.note {
  background: #eef7ee;
  padding: 10px;
  border-left: 4px solid #198038;
  margin-top: 10px;
}
.preview {
  background: #f9fafb;
  padding: 10px;
  border-left: 4px solid #6f6f6f;
  margin-top: 10px;
}
</style>
</head>

<body>
<div class="container">

<h1>Analytics Configuration Portal</h1>

<!-- TABS -->
<div class="tabs">
  <div class="tab active" onclick="openTab('engineer')">System Engineer</div>
  <div class="tab" onclick="openTab('user')">End User</div>
</div>

<!-- ================= SYSTEM ENGINEER TAB ================= -->
<div id="engineer" class="tab-content active">

  <div class="card">
    <h2 class="engineer">1. Data Selection</h2>
    <label>Field</label>
    <select id="e_field">
      <option>Temperature</option>
      <option>Pressure</option>
      <option>Vibration</option>
    </select>

    <label>Device ID</label>
    <input id="e_device" placeholder="machine-01">
  </div>

  <div class="card">
    <h2 class="engineer">2. Condition</h2>
    <div class="row">
      <div class="col">
        <label>Operator</label>
        <select id="e_op">
          <option value="">None</option>
          <option>&gt;</option>
          <option>&lt;</option>
          <option>=</option>
        </select>
      </div>
      <div class="col">
        <label>Value</label>
        <input id="e_val" placeholder="80">
      </div>
    </div>
  </div>

  <div class="card">
    <h2 class="engineer">3. Aggregation & Window</h2>
    <label>Aggregation</label>
    <select id="e_agg">
      <option>AVG</option>
      <option>MAX</option>
      <option>MIN</option>
      <option>COUNT</option>
    </select>

    <label>Window (minutes)</label>
    <input id="e_win" value="5">
  </div>

  <div class="card">
    <h2 class="engineer">4. Generated ASA Query</h2>
    <button class="primary" onclick="generateQuery()">Generate Query</button>
    <pre id="engineerQuery">-- query will appear here</pre>
  </div>

  <div class="card">
    <h2 class="engineer">5. Deployment</h2>
    <button class="primary">Generate PowerShell</button>
    <button class="primary">Generate ARM / Bicep</button>
  </div>

</div>

<!-- ================= END USER TAB ================= -->
<div id="user" class="tab-content">

  <div class="card">
    <h2 class="user">1. Select Metric</h2>
    <label>Metric</label>
    <select id="u_metric">
      <option>Temperature</option>
      <option>Pressure</option>
      <option>Vibration</option>
    </select>

    <label>Device</label>
    <select>
      <option>All Devices</option>
      <option>Machine-01</option>
      <option>Machine-02</option>
    </select>
  </div>

  <div class="card">
    <h2 class="user">2. Threshold</h2>
    <label>Condition</label>
    <select id="u_op" onchange="toggleBetween()">
      <option value=">">Greater than</option>
      <option value="<">Less than</option>
      <option value="between">Between</option>
    </select>

    <label>Value</label>
    <input id="u_val1">

    <label id="betweenLabel" style="display:none;">Upper Value</label>
    <input id="u_val2" style="display:none;">
  </div>

  <div class="card">
    <h2 class="user">3. Preview</h2>
    <button class="success" onclick="previewThreshold()">Preview</button>
    <div id="thresholdPreview" class="preview" style="display:none;"></div>
  </div>

  <div class="card">
    <h2 class="user">4. Save</h2>
    <button class="success">Save Threshold</button>
    <div class="note">
      Alerts will trigger when threshold conditions are met.
    </div>
  </div>

</div>

</div>

<script>
function openTab(tab) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

  document.querySelector(`[onclick="openTab('${tab}')"]`).classList.add('active');
  document.getElementById(tab).classList.add('active');
}

function generateQuery() {
  const f = e_field.value;
  const d = e_device.value;
  const o = e_op.value;
  const v = e_val.value;
  const a = e_agg.value;
  const w = e_win.value;

  let where = "";
  if (o && v) where = `WHERE ${f} ${o} ${v}`;
  if (d) where += where ? ` AND DeviceId='${d}'` : `WHERE DeviceId='${d}'`;

  engineerQuery.textContent = `
SELECT
  DeviceId,
  ${a}(${f}) AS ${a}_${f}
FROM Input
${where}
TIMESTAMP BY EventTime
GROUP BY DeviceId, TumblingWindow(minute, ${w})
`.trim();
}

function toggleBetween() {
  const isBetween = u_op.value === "between";
  betweenLabel.style.display = isBetween ? "block" : "none";
  u_val2.style.display = isBetween ? "block" : "none";
}

function previewThreshold() {
  const metric = u_metric.value;
  const op = u_op.value;
  const v1 = u_val1.value;
  const v2 = u_val2.value;

  let text = op === "between"
    ? `Alert when ${metric} is between ${v1} and ${v2}`
    : `Alert when ${metric} ${op} ${v1}`;

  thresholdPreview.innerText = text;
  thresholdPreview.style.display = "block";
}
</script>

</body>
</html>
